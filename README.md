# Mesto - Социальная сеть для обмена фотографиями мест

## О проекте

Mesto - это клиент-серверное веб-приложение, которое позволяет пользователям делиться фотографиями интересных мест. Пользователи могут создавать карточки с фотографиями, ставить лайки, редактировать свой профиль и просматривать карточки других пользователей. Проект реализован как полноценное приложение с отдельным сервером на Java и клиентской частью на JavaScript.

## Технологии и инструменты

### Серверная часть (Backend)
- **Java 11** - основной язык программирования для сервера
- **Maven** - система сборки и управления зависимостями
- **H2 Database** - встроенная реляционная база данных (файловая, не требует отдельной установки)
- **Gson** - библиотека для работы с JSON (сериализация и десериализация данных)
- **HttpServer** (com.sun.net.httpserver) - встроенный HTTP-сервер Java для обработки REST API запросов
- **SLF4J** - система логирования

### Клиентская часть (Frontend)
- **JavaScript (ES6+)** - основной язык для клиентской логики
- **Webpack** - сборщик модулей и бандлер
- **Babel** - транспилятор для поддержки современного JavaScript в старых браузерах
- **CSS** - стилизация с использованием методологии БЭМ (Блок-Элемент-Модификатор)
- **HTML5** - разметка страницы

### Архитектура
- **MVC (Model-View-Controller)** - архитектурный паттерн на сервере
- **REST API** - протокол взаимодействия между клиентом и сервером
- **CORS** - поддержка кросс-доменных запросов

## Структура проекта

### Серверная часть (`/server`)

```
server/
├── src/main/java/ru/mesto/server/
│   ├── Server.java              # Главный класс сервера, настройка HTTP-сервера и маршрутов
│   ├── AdminConsole.java        # Консольное администрирование сервера
│   ├── config/
│   │   └── Config.java          # Загрузка конфигурации из файла
│   ├── controller/              # Контроллеры (обработка HTTP-запросов)
│   │   ├── AuthController.java  # Авторизация (регистрация, вход)
│   │   ├── UserController.java  # Работа с профилем пользователя
│   │   └── CardController.java   # Работа с карточками
│   ├── dao/                      # Data Access Object (работа с базой данных)
│   │   ├── DatabaseManager.java # Управление подключением к БД
│   │   ├── UserDAO.java         # Операции с пользователями
│   │   └── CardDAO.java          # Операции с карточками
│   ├── model/                    # Модели данных
│   │   ├── User.java            # Модель пользователя
│   │   ├── Card.java            # Модель карточки
│   │   ├── CardResponse.java    # Формат ответа для карточки
│   │   └── Like.java            # Модель лайка
│   └── util/                     # Утилиты
│       ├── Logger.java          # Кастомное логирование
│       └── PasswordUtil.java     # Хэширование паролей
├── src/main/resources/
│   └── config.properties        # Конфигурационный файл (порт, БД, логи)
├── data/                         # База данных H2 (создается автоматически)
├── logs/                         # Логи сервера
└── pom.xml                       # Конфигурация Maven
```

### Клиентская часть (`/src`)

```
src/
├── index.html                    # Главная HTML-страница
├── index.css                     # Главный CSS-файл
├── scripts/                      # JavaScript модули
│   ├── index.js                  # Основная логика приложения
│   ├── api.js                    # API-запросы к серверу
│   ├── card.js                   # Логика работы с карточками
│   ├── modal.js                  # Управление модальными окнами
│   └── validation.js             # Валидация форм
├── blocks/                       # CSS-блоки по методологии БЭМ
│   ├── card/                     # Стили карточек
│   ├── popup/                    # Стили модальных окон
│   ├── profile/                  # Стили профиля
│   ├── header/                   # Стили шапки
│   └── ...
└── images/                       # Изображения и иконки
```

## Как работает приложение

### Общая схема работы

1. **Сервер** запускается на порту 3000 и слушает HTTP-запросы
2. **Клиент** (веб-страница) отправляет запросы к серверу через REST API
3. **Сервер** обрабатывает запросы, работает с базой данных и возвращает JSON-ответы
4. **Клиент** получает данные и отображает их на странице

### Основные функции

#### Авторизация
- **Регистрация**: пользователь создает аккаунт с email, паролем, именем (опционально: описание, аватар)
- **Вход**: авторизация по email и паролю
- **Выход**: выход из аккаунта с подтверждением
- Пароли хранятся в зашифрованном виде (SHA-256)
- После авторизации пользователь получает токен, который используется для последующих запросов

#### Профиль пользователя
- Просмотр своего профиля (имя, описание, аватар)
- Редактирование имени и описания
- Изменение аватара по URL-ссылке
- Профиль виден только авторизованным пользователям

#### Карточки
- **Просмотр карточек**: все карточки отображаются всегда, даже без авторизации
- **Создание карточек**: только для авторизованных пользователей (название места и ссылка на фото)
- **Удаление карточек**: только свои карточки
- **Лайки**: авторизованные пользователи могут ставить и убирать лайки
- **Просмотр фото**: клик по карточке открывает полноразмерное изображение

### Архитектура сервера

#### MVC паттерн
- **Model** (`model/`) - классы данных (User, Card, Like)
- **View** - JSON-ответы, которые отправляются клиенту
- **Controller** (`controller/`) - обработка HTTP-запросов и бизнес-логика

#### DAO паттерн
- **DAO** (Data Access Object) - классы для работы с базой данных
- Отделяет бизнес-логику от деталей работы с БД
- `UserDAO` - операции с пользователями
- `CardDAO` - операции с карточками и лайками

#### База данных
- Используется H2 Database (файловая БД)
- Автоматически создается при первом запуске в `server/data/`
- Таблицы:
  - `users` - пользователи (id, email, password, name, about, avatar, authorization token)
  - `cards` - карточки (id, name, link, owner_id, created_at)
  - `likes` - лайки (id, user_id, card_id)

### REST API

Сервер предоставляет следующие эндпоинты:

#### Авторизация
- `POST /signup` - регистрация нового пользователя
- `POST /signin` - вход в систему

#### Пользователи
- `GET /users/me` - получить информацию о текущем пользователе
- `PATCH /users/me` - обновить имя и описание
- `PATCH /users/me/avatar` - обновить аватар

#### Карточки
- `GET /cards` - получить все карточки
- `POST /cards` - создать новую карточку
- `DELETE /cards/{cardId}` - удалить карточку
- `PUT /cards/likes/{cardId}` - поставить лайк
- `DELETE /cards/likes/{cardId}` - убрать лайк

### Безопасность

- Пароли хэшируются перед сохранением в БД
- Используются токены авторизации для идентификации пользователей
- CORS настроен для безопасной работы с фронтендом
- Валидация данных на клиенте и сервере

### Логирование

- Все события сервера логируются в файл `server/logs/server.log`
- Логируются запросы, ошибки, операции с БД
- Кастомный класс `Logger` для удобного управления логами

### Консольное администрирование

Во время работы сервера доступна консоль для администрирования:
- `stats` - статистика (количество пользователей, карточек, лайков)
- `users` - список всех пользователей
- `cards` - список всех карточек
- `exit` - остановить сервер

## Запуск проекта

### Требования
- Java 11 или выше
- Maven 3.6+
- Node.js и npm

### Быстрый старт

1. **Запуск сервера:**
```bash
cd server
mvn clean package
java -jar target/mesto-server-1.0-SNAPSHOT.jar
```

2. **Запуск клиента:**
```bash
npm install
npm run dev
```

3. Откройте браузер по адресу, указанному webpack (обычно `http://localhost:8080`)

Подробная инструкция по запуску находится в файле `ИНСТРУКЦИЯ_ПО_ЗАПУСКУ.md`.

## Конфигурация

Настройки сервера находятся в `server/src/main/resources/config.properties`:
- `server.port` - порт сервера (по умолчанию 3000)
- `db.url` - URL базы данных
- `log.file` - путь к файлу логов

## Особенности реализации

- **Без Spring Framework**: сервер реализован на чистом Java с использованием встроенного HttpServer
- **Fat JAR**: используется Maven Shade Plugin для создания исполняемого JAR со всеми зависимостями
- **Модульная структура**: код разделен на логические модули (controllers, dao, model, util)
- **БЭМ методология**: CSS организован по методологии Блок-Элемент-Модификатор
- **Валидация форм**: клиентская валидация с отображением ошибок
- **Адаптивный дизайн**: интерфейс адаптируется под разные размеры экранов

## Лицензия

ISC
